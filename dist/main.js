!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);class o{handleErrors(e){console.log("Handling errors."),this.clearExistingErrors(),e&&e.hasErrors?e.errors.forEach(e=>{console.log("Selector: .error_"+e.fieldName),document.querySelectorAll(".error_"+e.fieldName).forEach(t=>{t.innerText=e.message,t.style.display="block"})}):console.log("No errors found, not doing anything.")}clearExistingErrors(){document.querySelectorAll(".error").forEach(e=>{e.style.display="none"})}}class i{constructor(e){this.options=e||{},this.validateOptions(),this.form=document.querySelector(this.options.selector),this.form?(this.errorHandler=new o,this.bindEvents()):console.log(`No form found on the page with the selector: '${this.options.selector}'`)}validateOptions(){if(!this.options.selector||!this.options.endpoint)throw new Error("Please specify both the 'selector' and 'endpoint' keys in the options object.")}bindEvents(){this.form.addEventListener("submit",this.onSubmit.bind(this))}onSubmit(e){const t=new FormData(this.form);console.log("Form submitted!",t),fetch(this.options.endpoint,{body:t,method:"POST"}).then(e=>e.json()).then(e=>{if(e.success)window.location.href=e.payload.redirectUrl;else{const t=e.payload.validation;this.errorHandler.handleErrors(t)}}),e.preventDefault()}}function s(e){return"tr"===e.tagName.toLowerCase()}class r{constructor(e){this.root=document.querySelector(".js-pagination"),this.root?(this.options=e||{onClickPage:e=>{}},this.currentPage=this.root.getAttribute("data-current-page"),this.bindEvents(),console.log("Pagination initialised, it is on page: "+this.currentPage,this.options)):console.warn("No pagination elements found on the page.")}bindEvents(){console.log("Binding pagination events."),document.addEventListener("click",this.onClickPagination.bind(this))}onClickPagination(e){if(e.target.matches(".js-pagination-page")){const t=parseInt(e.target.getAttribute("data-page"));return this.currentPage=t,console.log("Clicked page: "+t),void this.onClickPage(t)}}onClickPage(e){this.options.onClickPage(e)}}new function(){new i({selector:".js-add-dkp-decay-interval-form",endpoint:"/guild-management/add-dkp-decay-interval"})},new function(){new i({selector:".js-award-dkp-form",endpoint:"/guild-management/award-dkp"})},new class{constructor(){this.table=document.querySelector(".js-decay-dkp-table"),this.table&&(this.errorHandler=new o,this.bindEvents())}bindEvents(){this.table.addEventListener("click",this.onClickTable.bind(this))}onClickTable(e){const t=function(e){if(s(e))return e;let t=e.parentElement;for(;null!==t;){if(s(t))return t;t=t.parentElement}return t}(e.target);e.target.matches(".js-decay-dkp")?this.onClickDecayBtn(t):(e.target.matches(".js-decay-dkp-cancel")&&this.onClickCancelDecayBtn(t),e.target.matches(".js-decay-dkp-confirm")&&this.onClickConfirmDecayBtn(t))}onClickDecayBtn(e){console.log("Clicked decay button."),this.showDkpForm(e)}showDkpForm(e){const t=e.querySelector(".js-decay-dkp"),n=e.querySelector(".js-decay-dkp-form");t.style.display="none",n.style.display="block"}onClickCancelDecayBtn(e){console.log("Cancelling cancel DKP process."),this.hideDkpForm(e),this.errorHandler.clearExistingErrors()}hideDkpForm(e){const t=e.querySelector(".js-decay-dkp");e.querySelector(".js-decay-dkp-form").style.display="none",t.style.display="block"}getDecayDkpRequestData(e){const t=e.querySelector(".js-decay-dkp-amount"),n=e.querySelector(".js-decay-dkp-reason"),o=e.querySelector(".js-decay-dkp-confirm");return{amount:parseFloat(t.value||0),reason:n.value,playerId:parseInt(o.dataset.playerId)}}onClickConfirmDecayBtn(e){console.log("Confirmed decay of DKP."),this.errorHandler.clearExistingErrors();const t=this.getDecayDkpRequestData(e);console.log(t),this.sendDecayDkpRequest(t).then(t=>{if(t.success)this.hideDkpForm(e),this.updateDkpValue(e,t.payload.newDkpValue);else{const e=t.payload.validation;this.errorHandler.handleErrors(e)}})}sendDecayDkpRequest(e){return fetch("/guild-management/decay-dkp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json())}updateDkpValue(e,t){e.querySelector(".js-decay-dkp-amount-cell").textContent=t}},new class{constructor(){this.button=document.querySelector(".js-delete-dkp-decay-interval-btn"),this.button&&this.bindEvents()}bindEvents(){this.button.addEventListener("click",this.onClick.bind(this))}onClick(e){console.log("Button clicked!"),fetch("/guild-management/delete-dkp-decay-interval",{method:"POST"}).then(e=>e.json()).then(e=>{e.success&&window.location.reload()})}},new class{constructor(){this.button=document.querySelector(".js-edit-dkp-decay-interval-btn"),this.button&&this.bindEvents()}bindEvents(){this.button.addEventListener("click",this.onClick.bind(this))}onClick(){console.log("Edit button clicked!")}},new function(){new i({endpoint:"/guild-management/edit",selector:".js-edit-guild-form"})},new function(){new i({selector:".js-forgotten-password-form",endpoint:"/forgotten-password"})},new class{constructor(){console.log("Created guild list..."),this.list=document.querySelector(".js-guild-list"),this.list?this.pagination=new r({onClickPage:this.onClickPage.bind(this)}):console.log("No guild list found on the page to bind events to.")}onClickPage(e){console.log("Guild list: clicked page - "+e),this.showLoading(),this.fetchGuildListPage(e).then(e=>{this.hideLoading(),this.list.innerHTML=e})}showLoading(){this.list.innerHTML="Loading..."}hideLoading(){this.list.innerHTML=""}fetchGuildListPage(e){return fetch(`/guilds/ajax?page=${e}`).then(e=>e.text())}},new function(){new i({selector:".js-login-form",endpoint:"/login"})},new class{constructor(){console.log("Created player list..."),this.list=document.querySelector(".js-player-list"),this.list?(this.guildId=this.list.getAttribute("data-guild-id"),this.pagination=new r({onClickPage:this.onClickPage.bind(this)})):console.log("No player list found on the page to bind events to.")}onClickPage(e){console.log("Guild list: clicked page - "+e),this.showLoading(),this.fetchPlayerListPage(e).then(e=>{this.hideLoading(),this.list.innerHTML=e})}showLoading(){this.list.innerHTML="Loading..."}hideLoading(){this.list.innerHTML=""}fetchPlayerListPage(e){return fetch(`/players/ajax?page=${e}&guildId=${this.guildId}`).then(e=>e.text())}},new function(){new i({selector:".js-reset-password-form",endpoint:"/reset-password"})},new function(){new i({selector:".js-signup-form",endpoint:"/signup"})},new class{constructor(){console.log("Created DKP history list..."),this.list=document.querySelector(".js-dkp-history-list"),this.list?(this.playerId=this.list.getAttribute("data-player-id"),this.pagination=new r({onClickPage:this.onClickPage.bind(this)})):console.log("No DKP history list found on the page to bind events to.")}onClickPage(e){console.log("DKP history list: clicked page - "+e),this.showLoading(),this.fetchDkpHistoryPage(e).then(e=>{this.hideLoading(),this.list.innerHTML=e})}showLoading(){this.list.innerHTML="Loading..."}hideLoading(){this.list.innerHTML=""}fetchDkpHistoryPage(e){return fetch(`/dkp-history/ajax?page=${e}&playerId=${this.playerId}`).then(e=>e.text())}}}]);